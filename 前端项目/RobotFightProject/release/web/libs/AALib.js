!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).AA=t.AA||{})}(this,(function(t){"use strict";class e{static findChildRecursive(t,e){let s=null;if(s=e.getChildByName(t),!s){let r=e.numChildren;for(let i=0;i<r;i++){const r=e.getChildAt(i);if(s=this.findChildRecursive(t,r),s)return s}}return s}static runFunctionRecursive(t,e,s){let r=t.numChildren;for(let i=0;i<r;i++){let r=t.getChildAt(i);this.runFunctionRecursive(r,e,s)}s.call(e,t)}static playerDragonBoneAni(t,e,s,r,i){var a=new Laya.Skeleton;return e.addChild(a),a.pos(s,r),a.on(Laya.Event.COMPLETE,this,i),a.load(t,new Laya.Handler(this,(function(){a.play(0,!1)}))),a}}class s{constructor(){this._keyValues={}}set(t,e){this._keyValues[t]=e}get(t){return this._keyValues[t]}remove(t){return this._keyValues[t]=null,delete this._keyValues[t],!0}clear(){this._keyValues={}}get keys(){let t=[];for(var e in this._keyValues)t.push(e);return t}}class r{static setLoadingPage(t){t&&(Laya.Scene.setLoadingPage(t),this._uiLoadscene=t)}static show(t,e,s=!1){if(!this.isOpenMap[t]){var r=this._appDic.get(t);null==r?(this.isOpenMap[t]=!0,Laya.Scene.open(t,s,e,Laya.Handler.create(this,e=>{this._appDic.set(t,e),delete this.isOpenMap[t]},null,!0),this._uiLoadscene?this._uiLoadscene.progressHandler:null)):r.open(s,e)}}static close(t){var e=this._appDic.get(t);e&&e.close()}static getView(t){return this._appDic.get(t)}static destory(t){var e=this._appDic.get(t);e&&(e.destroy(!0),this._appDic.remove(t))}}r._appDic=new s,r.isOpenMap={};class i{}i.SERVER_LOGIN_FAIL="SERVER_LOGIN_FAIL",i.SERVER_SKEY_EXPIRE="SERVER_SKEY_EXPIRE",i.LOGIN_REGION_SERVER="LOGIN_REGION_SERVER",i.HTTP_REQ_ERROR="HTTP_REQ_ERROR",i.CONNECT_SERVER_SUCCESS="CONNECT_SERVER_SUCCESS",i.REC_SOCKET_MSG="REC_SOCKET_MSG",i.WS_CLOSED="WS_CLOSED",i.SUBGAME_RECONNECT="SUBGAME_RECONNECT";class a{}a.ACCOUNT_LOGIN="/account/login",a.REGION_LOGIN=2,a.MOBILE_LOGIN="/mobile/login",a.VISITOR_LOGIN="/visitor/login",a.ACCOUNT_OPERATE="/account/operate",a.GET_VERIFY_CODE="/get/verify/code";class n extends Laya.EventDispatcher{constructor(){super()}addEventListener(t,e,s,r){return super.on(t,e,s,r)}removeEventListener(t,e,s,r){return super.off(t,e,s,r)}hasEventListener(t){return super.hasListener(t)}dispatchEvent(t,e){return super.event(t,e)}}class o{constructor(){throw new Event("静态类")}static dispatchEvent(t,...e){var s=o._evtMap[t];if(s){var r=s.concat(),i=0,a=r.length;for(i=0;i<a;i++){var n=r[i],l=n.fun,h=n.args||[],c=n.caller;if(null!=l){var u=[];h&&h.length&&(u=u.concat(h)),e&&e.length&&(u=u.concat(e)),u&&u.length?l.apply(c,u):l.apply(c)}}}}static addEvent(t,e,s,...r){if(o.hasEvent(t,e,s))console.error("重复注册相同事件:"+t+",返回!");else{var i=o._evtMap[t];i||(i=new Array,o._evtMap[t]=i),i[i.length]={fun:s,args:r,caller:e}}}static removeEvent(t,e,s){var r=o._evtMap[t];if(r){for(var i=r.length-1;i>=0;i--){var a=r[i];s==a.fun&&a.caller==e&&r.splice(i,1)}0==r.length&&delete o._evtMap[t]}}static hasTypeEvent(t){return o._evtMap.hasOwnProperty(t)}static hasEvent(t,e,s){var r=o._evtMap[t];if(r)for(var i=r.length-1;i>=0;i--){var a=r[i];if(s==a.fun&&a.caller==e)return!0}return!1}static removeAllEvents(){o._evtMap={}}static getTypeEventList(t){var e=new Array,s=o._evtMap[t];if(s)for(var r=s.length-1;r>=0;r--){var i=s[r].fun;e.push(i)}return e}static getTypeEventsNum(t){var e=o._evtMap[t];return e?e.length:0}}o._evtMap={};class l{static get isTrace(){return this._isTrace}static set isTrace(t){this._isTrace=t,t||(console.log=()=>{})}static loadScript(t,e,s,r=!0){if(this.allLoadedScript.get(t)){if(!r)return console.log("3"),void(e&&e());console.log("2"),this.destroyScript(t)}var i=document.createElement("script");i.async=!1,Laya.URL.isLocal?i.src=t+"?v="+Laya.Browser.now():i.src=t,i.onload=function(){e&&e(),l.allLoadedScript.set(t,i),delete l.jsLoadTimes[t]},i.onerror=function(){console.error("加载js失败： "+i.src),null==l.jsLoadTimes[t]&&(l.jsLoadTimes[t]=0),l.jsLoadTimes[t]=l.jsLoadTimes[t]+1,l.jsLoadTimes[t]<=3?(console.error("子游戏加载失败，正在重试，次数：",l.jsLoadTimes[t]),l.loadScript(t,e,s)):(s&&s(),delete l.jsLoadTimes[t])},document.body.appendChild(i)}static scriptISLoaded(t){return null!=this.allLoadedScript.get(t)}static destroyScript(t){document.body.removeChild(this.allLoadedScript.get(t)),this.allLoadedScript.remove(t)}}var h;l.gameStartUpType=-1,l.isOpenDebug=!1,l._isTrace=!1,l.jsLoadTimes={},l.allLoadedScript=new s,function(t){t[t.GAME_STARTER=0]="GAME_STARTER",t[t.GAME_LOBBY=1]="GAME_LOBBY",t[t.GAME_SUBGAME=2]="GAME_SUBGAME"}(h||(h={}));class c{static isLock(t){return this._dic.get(t)}static addLock(t,e){this._dic.set(t,t),Laya.timer.once(e,this,(function(){c._dic.remove(t)}),null,!0)}}c._dic=new s;class u extends Laya.Byte{constructor(t=""){super(),""==t||t==Laya.Byte.BIG_ENDIAN?this.endian=Laya.Byte.BIG_ENDIAN:this.endian=Laya.Byte.LITTLE_ENDIAN}writeVarint32(t){for(;;){if(0==(-128&t))return void this.writeByte(t);this.writeByte(127&t|128),t>>>=7}}readVarint32(){return 0|this.readUint32()}readUint32(){for(var t=0,e=0;;e+=7){var s=this.readUint8();if(!(e<32)){for(;this.readUint8()>=128;);break}if(!(s>=128)){t|=s<<e;break}t|=(127&s)<<e}return t}writeUint32(t){for(;;){if(t<128)return void this.writeByte(t);this.writeByte(127&t|128),t>>>=7}}}class d{constructor(){this.serverIP="ws://192.168.3.108:30001/websocket",this.init()}static get ins(){return this._ins||(this._ins=new d),this._ins}init(){this.socket=new Laya.Socket,this.socket.endian=Laya.Byte.BIG_ENDIAN,this.socket.on(Laya.Event.OPEN,this,this.openHandler),this.socket.on(Laya.Event.MESSAGE,this,this.receiveHandler),this.socket.on(Laya.Event.CLOSE,this,this.closeHandler),this.socket.on(Laya.Event.ERROR,this,this.errorHandler)}get connected(){return!!this.socket&&this.socket.connected}connect(){this.connected||(this.socket&&this.serverIP?this.socket.connectByUrl(this.serverIP):console.warn("socket 或serverIP为null"))}send(t){if(!this.connected)return void console.log("socket 未连接！");var e=new Laya.Byte;let s=t;for(let t in s)e.writeUint8(s[t]);this.socket.send(e.buffer)}openHandler(t=null){console.log("socket:正确建立连接",new Date),o.dispatchEvent(i.CONNECT_SERVER_SUCCESS)}receiveHandler(t=null){o.dispatchEvent(i.REC_SOCKET_MSG,t)}closeHandler(t=null){console.log("socket:关闭",new Date),o.dispatchEvent(i.WS_CLOSED)}errorHandler(t=null){console.log("socket:连接出错"),o.dispatchEvent(i.WS_CLOSED)}close(){this.connected&&this.socket.close()}}class p extends n{constructor(){super(),this.onSuccess=t=>{console.log("HTTP请求服务器返回:",t),console.log("请求耗时:",(new Date).getTime()-this._startTime,this._url),this.event(Laya.Event.COMPLETE,t)},this.onFail=t=>{console.warn("onHttpFail",JSON.stringify(t)),this.event(Laya.Event.ERROR,t)}}request(t,e,s,r){this._startTime=(new Date).getTime(),this._url=t,console.log("HTTP请求服务器:"+t+"参数=",s);var i="";if(s instanceof Object){for(var a in s)i+=a+"="+s[a]+"&";s=JSON.stringify(s)}i.length>0&&(s=i=i.substr(0,i.length-1));var n=new Laya.HttpRequest;if(n.on(Laya.Event.COMPLETE,this,this.onSuccess),n.on(Laya.Event.ERROR,this,this.onFail),r){var o=new Array;for(var a in r)o.push(a),o.push(r[a]);n.send(t,s,e,"json",o)}else n.send(t,s,e,"json")}}class g{constructor(){this._access_token=null}get access_token(){return this._access_token}setup(t){this._serverAddr=t}login(t){this.request(a.MOBILE_LOGIN,t,"POST")}regionLogin(){this.request(i.LOGIN_REGION_SERVER,{cmdType:a.REGION_LOGIN},"post")}get isLoginSuccess(){return null!=this._access_token}request(t,e=null,s="POST",r=null){var i=new p,a=this._serverAddr+t;i.request(a,s,e,r),i.on(Laya.Event.COMPLETE,this,this.onReqSuccess,[t]),i.on(Laya.Event.ERROR,this,this.onReqError,[t])}onReqSuccess(t,e){console.log("response",e),e&&(console.log("response",e),o.dispatchEvent(t,e))}onReqError(t,e){e&&o.dispatchEvent(i.HTTP_REQ_ERROR,t,e)}}g.WX_HEADER_REGION="X-WX-Region",g.X_WX_GAME_ID="x-wx-game-id",g.X_WX_OPEN_ID="x-wx-open-id",g.CONTENT_TYPE="Content-Type";class f{constructor(){}static setup(t){this._miniHttpSerer=new g,this._miniHttpSerer.setup(t)}static login(t,e){this._miniHttpSerer?f.request(t,e,"POST"):console.error("Mini HTTP Server 尚未初始化")}static regionLogin(){this._miniHttpSerer.regionLogin()}static request(t,e=null,s="POST",r=null){this._miniHttpSerer?this._miniHttpSerer.request(t,e,s,r):console.error("Mini HTTP Server 尚未初始化")}}class v{static getRandom(t=0,e=100){return Math.floor(Math.random()*(e-t+1))+t}static seedRandom(t=0,e=1){return this.seed=(9301*this.seed+49297)%233280,t+this.seed/233280*(e-t)}static getAngleWithTwoPoint(t,e,s,r){var i=-180*Math.atan2(r-e,s-t)/Math.PI;return i<0&&(i=360+i),i}static getRandomNumber(t=0,e=100){return Math.random()*(e-t)+t}static toVec3String(t){return t.x+","+t.y+","+t.z}static DistanceOnXZPlane(t,e){let s=t.x-e.x,r=t.z-e.z;return Math.sqrt(s*s+r*r)}static hexToRgba(t,e){-1==t.indexOf("#")&&(t="#"+t);var s=parseInt("0x"+t.slice(1,3)),r=parseInt("0x"+t.slice(3,5)),i=parseInt("0x"+t.slice(5,7));return e?(e.x=s/255,e.y=r/255,e.z=i/255,e.w=1,e):new Laya.Vector4(s/255,r/255,i/255,1)}static getRandomNums(t,e,s){for(var r=[],i=t;i<=e;i++)r.push(i);return r.sort((function(){return.5-Math.random()})),r.length=s,r}static concatenate(t,...e){let s=0;for(let t of e)s+=t.length;let r=new t(s),i=0;for(let t of e)r.set(t,i),i+=t.length;return r}}v.seed=5,v.seedIndex=0,v.seedAry=[];class y extends Laya.Sprite{constructor(t="",e=0,s="left"){super(),this._align="left",this._skin=t,this._gap=e,this._align=s,this._box=new Laya.Sprite,this.addChild(this._box)}init(t="",e=0,s="left",r){this._skin=t,this._gap=e,this._align=s,r&&(this.width=r)}set gap(t){this._gap=t}clearBox(){for(this._box.numChildren;this._box.numChildren;){var t=this._box.getChildAt(0);t.removeSelf(),Laya.Pool.recover(this._skin,t)}}set number(t){this.clearBox();for(var e=t.toString(),s=e.length,r=0;r<s;r++){var i=Laya.Pool.getItemByCreateFun(this._skin,this.createClip.bind(this));i.index=parseInt(e.charAt(r)),i.pos(r*i.width+this._gap*r,0),this._box.addChild(i)}var a=s*i.width;"left"==this._align?this._box.x=0:"center"==this._align?this._box.x=(this.width-a)/2:this._box.x=this.width-a}createClip(){return new Laya.Clip(this._skin,10,1)}}class E{static init(){Laya.timer.frameLoop(1,this,this.onUpdate)}static addHandler(t){this.handlerList.push(t)}static addFun(t,e,s){this.addHandler(Laya.Handler.create(t,e,s))}static onUpdate(){for(this.thisRunNum=0;this.handlerList.length>0;){if(l.isOpenDebug)var t=Laya.stage.getTimeFromFrameStart();var e=this.handlerList.shift();if(e.run(),l.isOpenDebug)Laya.stage.getTimeFromFrameStart()-t>=5&&console.warn("执行耗时异常，请检查：",e);if(this.thisRunNum++,this.thisRunNum>=this.minRunFunNum&&Laya.stage.getTimeFromFrameStart()>16){l.isOpenDebug&&console.log("[FrameApplyUtil] 当前剩余的列表长度：",this.handlerList.length);break}}}static clearAll(){this.handlerList=new Array}}E.handlerList=new Array,E.minRunFunNum=5,E.thisRunNum=0;class _{constructor(){}static compileShader(t,e){this.callHandler=e,this.findAllObject(t),this.isRunning||Laya.timer.callLater(this,this.doCompileShader)}static doCompileShader(){var t,e,s=this.allModelObjArr.pop();if(null==s)return this.isRunning=!1,void(this.callHandler&&this.callHandler.run());if(this.isRunning=!0,s instanceof Laya.ShuriKenParticle3D?e=s.particleRenderer:s instanceof Laya.SkinnedMeshSprite3D?e=s.skinnedMeshRenderer:s instanceof Laya.MeshSprite3D&&(e=s.meshRenderer),null!=e&&(t=e._renderElements))for(var r=0,i=t.length;r<i;r++)t[r]._render(Laya.RenderContext3D._instance,!0);l.isOpenDebug&&console.log("当前解析shader耗时：",Laya.stage.getTimeFromFrameStart()),Laya.stage.getTimeFromFrameStart()>=10?Laya.timer.frameOnce(2,this,this.doCompileShader):this.doCompileShader()}static findAllObject(t){t instanceof Laya.ShuriKenParticle3D||t instanceof Laya.SkinnedMeshSprite3D||t instanceof Laya.MeshSprite3D?this.allModelObjArr.push(t):t instanceof Laya.Animator&&(t=t.owner);for(var e=0,s=t.numChildren;e<s;e++)this.findAllObject(t.getChildAt(e))}}_.isRunning=!1,_.allModelObjArr=[];class m{}m.ParticleController=class{constructor(){this.totalTime=0,this.prefabId=0,this.duration=0}init(t,s=0){this.parentSprite3D=t,this.totalTime=0,this.duration=s,this.psArray=new Array,e.runFunctionRecursive(t,this,this.processPS)}processPS(t){var e=t;null!=e.particleSystem&&(this.totalTime=Math.max(1e3*e.particleSystem.startLifetimeConstant,this.totalTime),this.psArray.push(e))}play(t,e){this.parentSprite3D.active=!0,null!=t&&t.addChild(this.parentSprite3D),this.duration>0?Laya.timer.once(this.duration,this,this.onPlayComplete):-1!=this.duration&&Laya.timer.once(this.totalTime,this,this.onPlayComplete),this.psArray.forEach(t=>{t.particleSystem&&(e&&(t.transform.scale=new Laya.Vector3(e,e,e)),t.particleSystem.play())})}stop(){Laya.timer.clearAll(this),this.parentSprite3D.active=!1,this.psArray.forEach(t=>{t.particleSystem&&t.particleSystem.stop()})}onPlayComplete(){if(this.stop(),this.parentSprite3D&&this.parentSprite3D.removeSelf(),null!=this.playCompleteFn){var t=this.playCompleteFn;this.playCompleteFn=null,t(this)}}destroy(){this.stop(),this.psArray.forEach(t=>{t.destroy(!0)}),this.psArray=null,this.parentSprite3D&&(this.parentSprite3D.destroy(!0),this.parentSprite3D=null),this.playCompleteFn=null}},m.LibEvent=i,m.LibHttpCmd=a,m.EventDispatcher=n,m.EventManager=o,m.GameManager=l,m.MsgLockManager=c,m.ByteBuffer=u,m.GameSocket=d,m.MiNi=f,m.MiniHttpRequest=p,m.MiniServer=g,m.ArrayUtil=class{static randomArray(t){let e=t.concat();for(var s=new Array;e.length>0;)s.push(e.splice(Math.floor(Math.random()*e.length),1)[0]);return s}static randomArrayBySeed(t){let e=t.concat();for(var s=new Array;e.length>0;)s.push(e.splice(Math.floor(v.seedRandom(0,1)*e.length),1)[0]);return s}static dimension1To2(t,e){let s=t.length;if(0==s||e<1)return;let r=s%e==0?s/e:Math.floor(s/e+1),i=[];for(let s=0;s<r;s++){let r=t.slice(s*e,s*e+e);i.push(r)}return i}static swatArray(t,e,s){let r=t[e],i=t[s];t[e]=i,t[s]=r}static getArraySameValue(t,e){var s=Array();if(null!=t&&null!=e&&t.length>0&&e.length>0)for(var r=0;r<t.length;r++)e.indexOf(t[r])>=0&&s.push(t[r]);return s}static getArrayDiffValue(t,e){var s=[];for(let r=0;r<t.length;r++)-1==e.indexOf(t[r])&&s.push(t[r]);return s}},m.CallBackFunc=class{constructor(t,e,...s){this.thisArgs=t,this.func=e,this.args=s}call(...t){if(this.func){var e=new Array;if(t)for(let s=0;s<t.length;++s)e.push(t[s]);if(this.args)for(let t=0;t<this.args.length;++t)e.push(this.args[t]);this.func.apply(this.thisArgs,e)}}},m.D3Tween=class{},m.Dictionary=s,m.MathUtil=v,m.StringUtil=class{static getAbridgeString(t,e=5){if(t){let r=new Laya.Byte,i=t.length;e*=5;for(var s=0;s<i;s++){let i=t.charAt(s);if(r.writeUTFString(i),r.length>e){t=t.substr(0,Math.max(1,s))+"...";break}}}return t}static strClamp(t,e,s){s||(s="..."),e*=2;for(var r=function(t){for(var e=[],s=0,r=0,i=0;i<t.length;){var a=i;if(65039!=(s=t.charCodeAt(i++)))if(r){var n=65536+(r-55296<<10)+(s-56320);e.push({v:n,pos:a}),r=0}else 55296<=s&&s<=56319?r=s:e.push({v:s,pos:a})}return e}(t),i=0,a=0,n=0;n<r.length;++n){var o=1;if(r[n].v>=128&&(o=2),i+o>e)break;a=n,i+=o}if(r.length-1==a)return t;var l=s?1:0;return t.substring(0,r[a-l].pos+1)+s}static getLabelCount(t){return t.replace(/[\u0391-\uFFE5]/g,"aa").length}},m.TimeUtil=class{static getTimeStr(){var t=new Date;return t.getFullYear()+"-"+(Number(t.getMonth())+1)+"-"+t.getDate()}static formatTime(t,e){var s={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var r in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+r+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?s[r]:("00"+s[r]).substr((""+s[r]).length)));return e}static getSecondTimeFomate(t){var e=!0;t<3600&&(e=!1);var s=Math.floor(t/3600)+"";1==s.length&&(s="0"+s);var r=Math.floor(t%3600/60)+"";1==r.length&&(r="0"+r);var i=Math.floor(t%60)+"";return 1==i.length&&(i="0"+i),e?s+":"+r+":"+i:r+":"+i}static getTimeStrFomate(t){var e="",s=Math.floor(t/3600);s>0&&(e+=s+"小时");var r=Math.floor(t%3600/60);return r>0&&(e+=r+"分"),e+=Math.floor(t%60)+"秒"}static getTimeFomate(t){var e="",s=Math.floor(t/3600);s>0&&(e+=s+":");var r=Math.floor(t%3600/60);return r>0&&(e+=r+":"),e+=Math.floor(t%60)}static checkIfPass1Day(t,e){return!(t<=e)&&(t.getFullYear()>e.getFullYear()||(t.getMonth()>e.getMonth()||t.getDate()>e.getDate()))}},m.UINumber=y,m.Utils=e,m.ViewController=r,m.SystemUtil=class{static isLocal(){return-1==window.location.href.indexOf("http://")&&-1==window.location.href.indexOf("https://")}static getThisBasePath(){var t=Laya.Browser.window.location,e=t.pathname;return e=":"==e.charAt(2)?e.substring(1):e,Laya.URL.getPath("file:"==t.protocol?e:t.protocol+"//"+t.host+t.pathname)}},m.GameStartUpType=h,m.FrameApplyUtil=E,m.ShaderCompileUtil=_,window.AA=m,t.AA=m,Object.defineProperty(t,"__esModule",{value:!0})}));